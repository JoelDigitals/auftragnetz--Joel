{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Company Dashboard" %}{% endblock %}

{% block content %}
<div class="w-full max-w-full mx-auto px-4 py-8 overflow-hidden">

  <!-- Tab Navigation -->
  <div class="flex w-full max-w-full overflow-x-auto space-x-4 mb-8 
              bg-white/20 dark:bg-gray-800/30 backdrop-blur-lg rounded-3xl shadow-lg p-2">
    <button data-tab="overview-section" 
      class="tab-btn active flex-shrink-0 flex flex-col items-center space-y-1 px-4 py-2">
      <span class="text-2xl md:text-3xl">üè†</span>
      <span class="text-sm md:text-base">{% trans "Overview" %}</span>
    </button>
    <button data-tab="leads-section" 
      class="tab-btn flex-shrink-0 flex flex-col items-center space-y-1 px-4 py-2 {% if not active_plan %}opacity-50 cursor-not-allowed{% endif %}"
      {% if not active_plan %}disabled{% endif %}>
      <span class="text-2xl md:text-3xl">üìã</span>
      <span class="text-sm md:text-base">{% trans "Leads" %}</span>
    </button>
    <button data-tab="products-section" 
      class="tab-btn flex-shrink-0 flex flex-col items-center space-y-1 px-4 py-2">
      <span class="text-2xl md:text-3xl">üõí</span>
      <span class="text-sm md:text-base">{% trans "Products" %}</span>
    </button>
    <button data-tab="jobs-section" 
      class="tab-btn flex-shrink-0 flex flex-col items-center space-y-1 px-4 py-2">
      <span class="text-2xl md:text-3xl">üíº</span>
      <span class="text-sm md:text-base">{% trans "Jobs" %}</span>
    </button>
    <button data-tab="profile-section" 
      class="tab-btn flex-shrink-0 flex flex-col items-center space-y-1 px-4 py-2">
      <span class="text-2xl md:text-3xl">üë§</span>
      <span class="text-sm md:text-base">{% trans "Profile" %}</span>
    </button>
  </div>

  <!-- Tab Content -->
  <div class="space-y-8 w-full max-w-full overflow-hidden">
    <!-- Overview -->
    <section id="overview-section" class="tab-content">
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
        <div class="card">
          <h4 class="text-lg font-semibold mb-2">{% trans "Profile Visits" %}</h4>
          <p class="text-3xl font-bold">{{ profile_visits_count }}</p>
          <p class="text-gray-500 dark:text-gray-400 text-sm">{% trans "Total visitors to your profile" %}</p>
        </div>
        <div class="card">
          <h4 class="text-lg font-semibold mb-2">{% trans "Active Leads" %}</h4>
          {% if active_plan %}
            <p class="text-3xl font-bold">{{ leads_count }}</p>
            <p class="text-gray-500 dark:text-gray-400 text-sm">{% trans "Leads collected from your offers" %}</p>
          {% else %}
            <p class="text-gray-400 italic">{% trans "Available with an active plan" %}</p>
          {% endif %}
        </div>
        <div class="card">
          <h4 class="text-lg font-semibold mb-2">{% trans "Products" %}</h4>
          <p class="text-gray-400 italic">{% trans "Coming Soon" %}</p>
        </div>
      </div>
    </section>

    <!-- Leads -->
<section id="leads-section" class="tab-content hidden">
  {% if active_plan %}
    <div class="card overflow-x-auto">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold">{% trans "Leads" %}</h3>
        <a href="{% url 'lead_preferences' %}" 
           class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
          ‚öôÔ∏è {% trans "Lead Einstellungen" %}
        </a>
      </div>

      {% if leads %}
        <div class="overflow-x-auto w-full">
          <table class="min-w-full text-left border-collapse">
            <thead>
              <tr class="border-b border-gray-300 dark:border-gray-600">
                <th class="px-4 py-2 whitespace-nowrap">{% trans "Name" %}</th>
                <th class="px-4 py-2 whitespace-nowrap">{% trans "Email" %}</th>
                <th class="px-4 py-2 whitespace-nowrap">{% trans "Number" %}</th>
                <th class="px-4 py-2 whitespace-nowrap">{% trans "Message" %}</th>
                <th class="px-4 py-2 whitespace-nowrap">{% trans "Date" %}</th>
              </tr>
            </thead>
            <tbody>
              {% for lead in leads %}
              <tr class="border-b border-gray-200 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                <td class="px-4 py-2">{{ lead.name }}</td>
                <td class="px-4 py-2">{{ lead.email }}</td>
                <td class="px-4 py-2">{{ lead.phone }}</td>
                <td class="px-4 py-2">{{ lead.message }}</td>
                <td class="px-4 py-2">{{ lead.created_at|date:"d.m.Y H:i" }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-gray-500 dark:text-gray-400">{% trans "No leads yet." %}</p>
      {% endif %}
    </div>
  {% else %}
    <p class="text-gray-400 italic">{% trans "Leads are only available with an active plan." %}</p>
  {% endif %}
</section>


    <!-- Products -->
    <section id="products-section" class="tab-content hidden">
  <div class="flex justify-between items-center mb-4">
    <h3 class="text-xl font-bold">{% trans "Products" %}</h3>
    <a href="{% url 'product_create' %}"
       class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
       ‚ûï {% trans "Add Product" %}
    </a>
  </div>

  {% if products %}
    <div class="grid md:grid-cols-2 gap-4">
    {% for product in products %}
      <div class="card">
        <h4 class="font-semibold text-lg">{{ product.title }}</h4>
        <p class="text-sm text-gray-500">{{ product.description|truncatewords:15 }}</p>
      
        <div class="flex justify-between items-center mt-3 text-sm">
            <span>{{ product.views }} views</span>
            {% if product.price %}<span>{{ product.price }} ‚Ç¨</span>{% endif %}
        </div>
      
        <div class="flex gap-2 mt-4">
            <a href="{% url 'product_detail' product.slug %}" class="btn-secondary">View</a>
            <a href="{% url 'product_edit' product.id %}" class="btn-primary">Edit</a>
            <a href="{% url 'product_delete' product.id %}" class="btn-danger">Delete</a>
        </div>
      </div>
    {% endfor %}
    </div>
    {% endif %}

    <!-- Jobs Section -->
    <section id="jobs-section" class="tab-content hidden">
      <div class="mt-10">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold">{% trans "Your Job Offers" %}</h2>
          <a href="{% url 'create_order' %}" 
             class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
             {% trans "Create Job" %}
          </a>
        </div>
      
        {% if jobs %}
          <div class="grid gap-4 md:grid-cols-2">
            {% for job in jobs %}
              <a href="{% url 'order_detail' job.id %}" 
                 class="block bg-white dark:bg-gray-800 p-4 rounded-lg shadow hover:shadow-lg transition">
                <h3 class="text-lg font-semibold mb-2">{{ job.title }}</h3>
                <p class="text-gray-600 dark:text-gray-400 mb-2">
                  {{ job.description|truncatewords:20 }}
                </p>
                <div class="flex justify-between text-sm text-gray-500 dark:text-gray-400">
                  <span>{% trans "Budget" %}: {{ job.budget }} ‚Ç¨</span>
                  <span>{% trans "Created" %}: {{ job.created_at|date:"d.m.Y" }}</span>
                </div>
              </a>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-gray-600 dark:text-gray-400">{% trans "You have no job offers yet." %}</p>
        {% endif %}
      </div>
    </section>

    <!-- Profile -->
    <section id="profile-section" class="tab-content hidden">
      <div class="card">
        <h3 class="text-xl font-bold mb-4">{% trans "Profile Settings" %}</h3>
        <p class="text-gray-500 dark:text-gray-400">{% trans "Your profile details and company information." %}</p>
        <div class="mt-4">
          <a href="{% url 'edit_profile' %}" 
            class="px-5 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg shadow transition">{% trans "Edit Profile" %}
          </a>
          <a href="{% url 'plans' %}" 
            class="px-5 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg shadow transition">{% trans "Pl√§ne" %}
          </a>
      </div>
    </section>
  </div>
</div>

<style>
  .tab-btn { 
    padding: .5rem 1rem; 
    border-radius: 1rem; 
    transition: all .2s; 
    flex-shrink: 0;
  }
  .tab-btn.active { 
    background-color: rgba(59,130,246,0.2); 
    font-weight: bold;
  }
  .tab-content { animation: fadeIn .3s ease-in-out; }
  @keyframes fadeIn {
    from {opacity: 0; transform: translateY(10px);}
    to {opacity: 1; transform: translateY(0);}
  }
  .card {
    backdrop-filter: blur(12px);
    background: rgba(255,255,255,0.2);
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 1.5rem;
    padding: 1.5rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
</style>

<script>
  document.querySelectorAll(".tab-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      if(btn.disabled) return;
      document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
      document.querySelectorAll(".tab-content").forEach(c => c.classList.add("hidden"));
      btn.classList.add("active");
      document.getElementById(btn.dataset.tab).classList.remove("hidden");
    });
  });
</script>
{% endblock %}
