{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Create Order" %}{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto px-4 py-6 md:py-10">
  
  <!-- Breadcrumb -->
  <nav class="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mb-6">
    <a href="{% url 'home' %}" class="hover:text-primary transition">{% trans "Home" %}</a>
    <i class="fas fa-chevron-right text-xs"></i>
    <a href="{% url 'order_list' %}" class="hover:text-primary transition">{% trans "Orders" %}</a>
    <i class="fas fa-chevron-right text-xs"></i>
    <span class="text-gray-900 dark:text-white font-medium">{% trans "Create" %}</span>
  </nav>

  <!-- Header -->
  <div class="text-center mb-8">
    <h1 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-2">
      {% trans "Create a New Order" %}
    </h1>
    <p class="text-gray-500 dark:text-gray-400 text-sm md:text-base">
      {% trans "Describe your project and find the perfect freelancer" %}
    </p>
  </div>

  <!-- Form Card -->
  <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden">
    <form method="post" class="p-6 md:p-8 space-y-6">
      {% csrf_token %}

      <!-- Title -->
      <div>
        <label for="id_title" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2">
          <i class="fas fa-heading text-gray-400"></i>
          {% trans "Title" %}
          <span class="text-red-500">*</span>
        </label>
        <div class="relative">
          <input 
            type="text" 
            id="id_title"
            name="title" 
            value="{{ title|default:'' }}"
            class="w-full pl-10 pr-4 py-2.5 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition"
            placeholder="{% trans 'e.g. Website redesign for small business' %}"
            required
          >
          <i class="fas fa-pen absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400"></i>
        </div>
        <p class="mt-1.5 text-xs text-gray-500 dark:text-gray-400">{% trans "Keep it short and descriptive" %}</p>
      </div>

      <!-- Description -->
      <div>
        <label for="id_description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2">
          <i class="fas fa-align-left text-gray-400"></i>
          {% trans "Description" %}
          <span class="text-red-500">*</span>
        </label>
        <textarea 
          id="id_description"
          name="description" 
          rows="5"
          class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition resize-none"
          placeholder="{% trans 'Describe your project requirements, goals, and any specific skills needed...' %}"
          required
        >{{ description|default:'' }}</textarea>
        <div class="flex justify-between mt-1.5">
          <p class="text-xs text-gray-500 dark:text-gray-400">{% trans "Be as detailed as possible" %}</p>
          <span class="text-xs text-gray-400" id="charCount">0 {% trans "characters" %}</span>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Budget -->
        <div>
          <label for="id_budget" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2">
            <i class="fas fa-euro-sign text-gray-400"></i>
            {% trans "Budget" %}
          </label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
              <span class="text-gray-500 font-medium">â‚¬</span>
            </div>
            <input 
              type="number" 
              id="id_budget"
              step="0.01" 
              min="0"
              name="budget" 
              value="{{ budget|default:'' }}"
              class="w-full pl-10 pr-4 py-2.5 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition"
              placeholder="{% trans '0.00' %}"
            >
          </div>
          <p class="mt-1.5 text-xs text-gray-500 dark:text-gray-400">{% trans "Leave empty for negotiation" %}</p>
        </div>

        <!-- Deadline -->
        <div>
          <label for="id_deadline" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2">
            <i class="fas fa-calendar-alt text-gray-400"></i>
            {% trans "Deadline" %}
          </label>
          <div class="relative">
            <input 
              type="date" 
              id="id_deadline"
              name="deadline" 
              value="{{ deadline|default:'' }}"
              min="{{ today|date:'Y-m-d' }}"
              class="w-full pl-10 pr-4 py-2.5 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition appearance-none"
            >
            <i class="fas fa-calendar absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400"></i>
          </div>
          <p class="mt-1.5 text-xs text-gray-500 dark:text-gray-400">{% trans "When do you need this completed?" %}</p>
        </div>
      </div>

      <!-- Categories -->
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2">
          <i class="fas fa-tags text-gray-400"></i>
          {% trans "Categories" %}
          <span class="text-xs text-gray-400 font-normal">({% trans "Select all that apply" %})</span>
        </label>
        <div class="bg-gray-50 dark:bg-gray-700/30 border border-gray-200 dark:border-gray-600 rounded-xl p-4 max-h-48 overflow-y-auto custom-scrollbar">
          <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
            {% for c in categories %}
            <label class="flex items-center gap-3 cursor-pointer group p-2 rounded-lg hover:bg-white dark:hover:bg-gray-700 transition">
              <input 
                type="checkbox" 
                name="categories" 
                value="{{ c.id }}"
                {% if c.id|stringformat:"s" in selected_categories %}checked{% endif %}
                class="w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary transition"
              >
              <span class="text-sm text-gray-700 dark:text-gray-300 group-hover:text-primary transition">{{ c.name }}</span>
            </label>
            {% endfor %}
          </div>
        </div>
        {% if categories|length == 0 %}
        <p class="mt-2 text-sm text-yellow-600 dark:text-yellow-400 flex items-center gap-1">
          <i class="fas fa-exclamation-triangle"></i>
          {% trans "No categories available. Please contact support." %}
        </p>
        {% endif %}
      </div>

      <!-- Status -->
      <div>
        <label for="id_status" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2">
          <i class="fas fa-info-circle text-gray-400"></i>
          {% trans "Status" %}
        </label>
        <div class="relative">
          <select 
            id="id_status"
            name="status"
            class="w-full pl-10 pr-10 py-2.5 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-900 dark:text-white appearance-none focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition"
          >
            {% for val, label in status_choices %}
            <option value="{{ val }}" {% if val == status|default:'open' %}selected{% endif %}>
              {{ label }}
            </option>
            {% endfor %}
          </select>
          <i class="fas fa-flag absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400"></i>
          <i class="fas fa-chevron-down absolute right-3.5 top-1/2 -translate-y-1/2 text-gray-400 text-xs pointer-events-none"></i>
        </div>
        <p class="mt-1.5 text-xs text-gray-500 dark:text-gray-400">{% trans "Only change if you want to save as draft" %}</p>
      </div>

      <!-- Submit Buttons -->
      <div class="flex flex-col sm:flex-row gap-3 pt-6 border-t border-gray-100 dark:border-gray-700">
        <button 
          type="submit" 
          class="flex-1 bg-gradient-to-r from-primary to-secondary text-white font-bold py-3 px-6 rounded-xl shadow-lg shadow-primary/30 hover:shadow-xl hover:shadow-primary/40 transform hover:-translate-y-0.5 active:translate-y-0 transition-all duration-200 flex items-center justify-center gap-2"
        >
          <i class="fas fa-plus-circle"></i>
          {% trans "Create Order" %}
        </button>
        <a 
          href="{% url 'order_list' %}" 
          class="flex-1 sm:flex-initial inline-flex items-center justify-center gap-2 py-3 px-6 text-gray-600 dark:text-gray-300 font-medium rounded-xl border border-gray-200 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition"
        >
          <i class="fas fa-times"></i>
          {% trans "Cancel" %}
        </a>
      </div>
    </form>
  </div>

  <!-- Tips Card -->
  <div class="mt-6 bg-green-50 dark:bg-green-900/20 border border-green-100 dark:border-green-800 rounded-2xl p-5">
    <h4 class="text-sm font-bold text-green-900 dark:text-green-300 mb-3 flex items-center gap-2">
      <i class="fas fa-lightbulb"></i>
      {% trans "Tips for a great order" %}
    </h4>
    <ul class="text-sm text-green-800 dark:text-green-200 space-y-2">
      <li class="flex items-start gap-2">
        <i class="fas fa-check-circle mt-0.5 text-xs"></i>
        <span>{% trans "Be specific about deliverables and requirements" %}</span>
      </li>
      <li class="flex items-start gap-2">
        <i class="fas fa-check-circle mt-0.5 text-xs"></i>
        <span>{% trans "Set a realistic budget to attract quality freelancers" %}</span>
      </li>
      <li class="flex items-start gap-2">
        <i class="fas fa-check-circle mt-0.5 text-xs"></i>
        <span>{% trans "Choose relevant categories for better visibility" %}</span>
      </li>
      <li class="flex items-start gap-2">
        <i class="fas fa-check-circle mt-0.5 text-xs"></i>
        <span>{% trans "Set a reasonable deadline with buffer time" %}</span>
      </li>
    </ul>
  </div>
</div>

<style>
  /* Custom scrollbar for categories */
  .custom-scrollbar::-webkit-scrollbar {
    width: 8px;
  }
  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: #cbd5e1;
    border-radius: 20px;
  }
  .dark .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: #475569;
  }
  
  /* Date input icon fix for dark mode */
  input[type="date"]::-webkit-calendar-picker-indicator {
    filter: invert(0.5);
    cursor: pointer;
  }
  .dark input[type="date"]::-webkit-calendar-picker-indicator {
    filter: invert(0.8);
  }
  
  /* Focus styles */
  input:focus, textarea:focus, select:focus {
    outline: none;
  }
</style>

<script>
  // Character counter for description
  const textarea = document.getElementById('id_description');
  const charCount = document.getElementById('charCount');
  
  if (textarea && charCount) {
    textarea.addEventListener('input', function() {
      const count = this.value.length;
      charCount.textContent = count + ' {% trans "characters" %}';
      
      if (count > 500) {
        charCount.classList.add('text-green-600', 'dark:text-green-400');
        charCount.classList.remove('text-gray-400');
      } else {
        charCount.classList.remove('text-green-600', 'dark:text-green-400');
        charCount.classList.add('text-gray-400');
      }
    });
    
    // Initial count
    if (textarea.value) {
      charCount.textContent = textarea.value.length + ' {% trans "characters" %}';
    }
  }
  
  // Set min date to today
  const dateInput = document.getElementById('id_deadline');
  if (dateInput) {
    const today = new Date().toISOString().split('T')[0];
    dateInput.setAttribute('min', today);
  }
</script>
{% endblock %}