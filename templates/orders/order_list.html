{% extends "base.html" %}
{% load i18n %}
{% block title %}{% trans "Orders" %}{% endblock %}

{% block content %}
<div class="grid grid-cols-1 md:grid-cols-4 gap-8">

  <!-- Sidebar Filter -->
  <aside class="md:col-span-1 space-y-6">

    <!-- Filterbox -->
    <div class="backdrop-blur-xl bg-white/20 dark:bg-gray-800/30 p-6 rounded-3xl shadow-xl border border-white/30 dark:border-gray-700/50">
      <h3 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">{% trans "Filter Orders" %}</h3>

      <!-- Suchfeld -->
      <div class="mb-5">
        <input type="text" id="search-input" name="q" placeholder="{% trans 'Search orders...' %}"
          value="{{ search|default:'' }}"
          class="w-full px-4 py-2.5 rounded-2xl border border-gray-300 dark:border-gray-600 bg-white/40 dark:bg-gray-700/40 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm">
      </div>

      <!-- Kategorie Filter -->
      <div>
        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-3">{% trans "Categories" %}</h4>
        <div class="flex flex-wrap gap-2">
          {% for c in categories %}
          <label class="cursor-pointer">
            <input type="checkbox" name="categories" value="{{ c.id }}"
              {% if c.id|stringformat:"s" in selected_categories %}checked{% endif %}
              class="hidden peer filter-checkbox">
            <span class="px-3 py-1.5 rounded-full border border-gray-300 dark:border-gray-600 text-sm text-gray-700 dark:text-gray-200 bg-white/40 dark:bg-gray-800/40 peer-checked:bg-blue-600 peer-checked:text-white transition shadow-sm">
              {{ c.name }}
            </span>
          </label>
          {% endfor %}
        </div>
      </div>

      <!-- Zeitraum Filter -->
      <div class="mt-5">
        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-3">{% trans "Posted within" %}</h4>
        <select id="days-select" name="days"
          class="w-full px-4 py-2.5 rounded-2xl border border-gray-300 dark:border-gray-600 bg-white/40 dark:bg-gray-700/40 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm">
          <option value="">{% trans "Any time" %}</option>
          <option value="1" {% if selected_days == "1" %}selected{% endif %}>{% trans "Last 24 hours" %}</option>
          <option value="7" {% if selected_days == "7" %}selected{% endif %}>{% trans "Last 7 days" %}</option>
          <option value="30" {% if selected_days == "30" %}selected{% endif %}>{% trans "Last 30 days" %}</option>
        </select>
      </div>
    </div>

    <!-- Werbung -->
    <div class="backdrop-blur-xl bg-white/20 dark:bg-gray-800/30 p-4 rounded-3xl shadow-md border border-white/30 dark:border-gray-700/40 text-center">
      <span class="text-gray-500 dark:text-gray-400 text-sm">{% trans "Advertisement" %}</span>
      <div class="mt-3 flex justify-center">
        <!-- Google AdSense Code -->
        <ins class="adsbygoogle"
             style="display:block; width:100%; max-width:300px; height:250px;"
             data-ad-client="ca-pub-DEINE_CLIENT_ID"
             data-ad-slot="DEIN_SLOT_ID"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      </div>
    </div>
    

  </aside>

  <!-- Hauptliste -->
  <section class="md:col-span-3">
    <h1 class="text-4xl font-extrabold mb-10 text-gray-900 dark:text-white tracking-tight">{% trans "Available Orders" %}</h1>

    {% if orders %}
    <div class="grid gap-8">
      {% for order in orders %}
      <div class="backdrop-blur-xl bg-white/20 dark:bg-gray-800/30 border border-white/30 dark:border-gray-700/50 p-6 rounded-3xl shadow-lg hover:shadow-2xl transition transform hover:-translate-y-1">
        <a href="{% url 'order_detail' order.pk %}" class="text-2xl font-bold text-blue-600 dark:text-blue-400 hover:underline">
          {{ order.title }}
        </a>
        <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">
          {{ order.get_status_display }} â€¢ {{ order.created_at|date:"d.m.Y" }}
        </p>
        <p class="mt-4 text-gray-800 dark:text-gray-200 leading-relaxed line-clamp-4">
          {{ order.description|truncatewords:40|linebreaks }}
        </p>
        <div class="mt-5 flex flex-wrap justify-between text-sm text-gray-500 dark:text-gray-400">
          <div class="mt-5 flex flex-wrap gap-2 text-sm text-gray-500 dark:text-gray-400">
            {% if order.category.all %}
              {% for cat in order.category.all %}
                <span class="px-2 py-1 text-xs rounded-full bg-blue-100/70 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 shadow-sm">
                  {{ cat.name }}
                </span>
              {% endfor %}
            {% else %}
              <span class="px-2 py-1 text-xs rounded-full bg-gray-200/50 dark:bg-gray-700/50 text-gray-500 dark:text-gray-400">-</span>
            {% endif %}
          </div>
          
          <span>ðŸ’° {{ order.budget|default:"-" }} â‚¬</span>
          <span>ðŸ“… {{ order.deadline|date:"d.m.Y" }}</span>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
      <p class="text-gray-600 dark:text-gray-400 mt-6">{% trans "No orders found." %}</p>
    {% endif %}
  </section>
</div>

<!-- JS fÃ¼r Auto-Filter -->
<script>
function updateFilters() {
  const params = new URLSearchParams();

  // Kategorien
  document.querySelectorAll(".filter-checkbox:checked").forEach(cb => {
    params.append("categories", cb.value);
  });

  // Suche
  const q = document.getElementById("search-input").value;
  if (q) params.set("q", q);

  // Zeitraum
  const days = document.getElementById("days-select").value;
  if (days) params.set("days", days);

  window.location = "?" + params.toString();
}

document.querySelectorAll(".filter-checkbox").forEach(cb => {
  cb.addEventListener("change", updateFilters);
});
document.getElementById("search-input").addEventListener("input", () => {
  clearTimeout(window.searchTimeout);
  window.searchTimeout = setTimeout(updateFilters, 400);
});
document.getElementById("days-select").addEventListener("change", updateFilters);
</script>
{% endblock %}
