{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Register" %}{% endblock %}

{% block content %}
<div class="max-w-md mx-auto bg-white/80 dark:bg-gray-800/80 backdrop-blur-md p-8 rounded-xl shadow-lg mt-10 border border-gray-200 dark:border-gray-700 transition-colors duration-300">
    <h2 class="text-3xl font-extrabold text-center text-blue-600 mb-6">
        {% trans "Create your Account" %}
    </h2>

    <form method="post" class="space-y-4">
        {% csrf_token %}

        <!-- Username -->
        <div>
            <label for="id_username" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{% trans "Username" %}</label>
            <input type="text" name="username" id="id_username"
                   value="{{ form.username.value|default:'' }}"
                   class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100/80 dark:bg-gray-700/70 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 transition">
            {% for error in form.username.errors %}
              <p class="text-red-500 dark:text-red-400 text-sm mt-1">{{ error }}</p>
            {% endfor %}
        </div>

        <!-- Email -->
        <div>
            <label for="id_email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{% trans "Email" %}</label>
            <input type="email" name="email" id="id_email"
                   value="{{ form.email.value|default:'' }}"
                   class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100/80 dark:bg-gray-700/70 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 transition">
            {% for error in form.email.errors %}
              <p class="text-red-500 dark:text-red-400 text-sm mt-1">{{ error }}</p>
            {% endfor %}
        </div>

        <!-- Phone -->
        <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{% trans "Phone Number" %}</label>
            <input type="text" name="phone_number" id="id_phone_number"
                   value="{{ form.phone_number.value|default:'' }}"
                   class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100/80 dark:bg-gray-700/70 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 transition">
            {% if form.phone_number.errors %}
                <p class="text-red-500 dark:text-red-400 text-sm mt-1">{{ form.phone_number.errors.0 }}</p>
            {% endif %}
        </div>

        <!-- Account type -->
        <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{% trans "Account Type" %}</label>
            <select name="account_type" id="id_account_type"
                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100/80 dark:bg-gray-700/70 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-400 transition">
                {% for choice in form.account_type.field.choices %}
                    <option value="{{ choice.0 }}" {% if form.account_type.value == choice.0 %}selected{% endif %}>
                        {{ choice.1 }}
                    </option>
                {% endfor %}
            </select>
            {% if form.account_type.errors %}
                <p class="text-red-500 dark:text-red-400 text-sm mt-1">{{ form.account_type.errors.0 }}</p>
            {% endif %}
        </div>

        <!-- Password -->
        <div>
            <label for="password1" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{% trans "Password" %}</label>
            <input type="password" name="password1" id="id_password1"
                   class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100/80 dark:bg-gray-700/70 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 transition">
            <ul class="mt-2 space-y-1 text-sm" id="password-rules">
                <li id="rule-length" class="text-red-500">✖ {% trans "At least 8 characters" %}</li>
                <li id="rule-uppercase" class="text-red-500">✖ {% trans "At least one uppercase letter" %}</li>
                <li id="rule-number" class="text-red-500">✖ {% trans "At least one number" %}</li>
                <li id="rule-special" class="text-red-500">✖ {% trans "At least one special character (!@#$...)" %}</li>
            </ul>
        </div>

        <!-- Password confirmation -->
        <div>
            <label for="password2" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{% trans "Confirm Password" %}</label>
            <input type="password" name="password2" id="id_password2"
                   class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100/80 dark:bg-gray-700/70 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 transition">
            <p id="password-match" class="mt-2 text-sm text-red-500">✖ {% trans "Passwords do not match" %}</p>
        </div>

        <!-- Submit -->
        <button type="submit"
                class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold shadow hover:bg-blue-700 transition">
            {% trans "Register" %}
        </button>
    </form>
    <a href="https://joel-digital.de/o/authorize/
?response_type=code
&client_id=CLIENT_ID
&redirect_uri=https://auftragsnetz.de/auth/joel/callback/
&scope=profile">
    Mit Joel Digital anmelden
</a>

</div>

<!-- Passwort Check Script -->
<script>
    const password1 = document.getElementById("id_password1");
    const password2 = document.getElementById("id_password2");
    const matchMsg = document.getElementById("password-match");

    function validatePassword() {
        const val = password1.value;
        const rules = {
            length: val.length >= 8,
            uppercase: /[A-Z]/.test(val),
            number: /[0-9]/.test(val),
            special: /[^A-Za-z0-9]/.test(val),
        };

        for (let [rule, passed] of Object.entries(rules)) {
            const el = document.getElementById("rule-" + rule);
            if (passed) {
                el.classList.remove("text-red-500");
                el.classList.add("text-green-600");
                el.innerHTML = "✔ " + el.textContent.replace("✖ ", "").replace("✔ ", "");
            } else {
                el.classList.remove("text-green-600");
                el.classList.add("text-red-500");
                el.innerHTML = "✖ " + el.textContent.replace("✔ ", "").replace("✖ ", "");
            }
        }

        if (password1.value && password2.value && password1.value === password2.value) {
            matchMsg.textContent = "✔ {% trans 'Passwords match' %}";
            matchMsg.classList.remove("text-red-500");
            matchMsg.classList.add("text-green-600");
        } else {
            matchMsg.textContent = "✖ {% trans 'Passwords do not match' %}";
            matchMsg.classList.remove("text-green-600");
            matchMsg.classList.add("text-red-500");
        }
    }

    password1.addEventListener("input", validatePassword);
    password2.addEventListener("input", validatePassword);
</script>
{% endblock %}
