{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Register" %}{% endblock %}

{% block content %}
<div class="max-w-md mx-auto bg-white p-8 rounded-xl shadow-lg">
    <h2 class="text-3xl font-extrabold text-center text-blue-600 mb-6">
        {% trans "Create your Account" %}
    </h2>

    <form method="post" class="space-y-4">
        {% csrf_token %}

        <!-- Username -->
        <div>
            <label for="id_username" class="block text-sm font-medium text-gray-700 mb-1">{% trans "Username" %}</label>
            <input type="text" name="username" id="id_username"
                   value="{{ form.username.value|default:'' }}"
                   class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-400">
            {% for error in form.username.errors %}
              <p class="text-red-500 text-sm mt-1">{{ error }}</p>
            {% endfor %}
        </div>

        <!-- Email -->
        <div>
            <label for="id_email" class="block text-sm font-medium text-gray-700 mb-1">{% trans "Email" %}</label>
            <input type="email" name="email" id="id_email"
                   value="{{ form.email.value|default:'' }}"
                   class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-400">
            {% for error in form.email.errors %}
              <p class="text-red-500 text-sm mt-1">{{ error }}</p>
            {% endfor %}
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Telefonnummer</label>
          {{ form.phone_number }}
          {% if form.phone_number.errors %}
            <p class="text-red-500 text-sm mt-1">{{ form.phone_number.errors.0 }}</p>
          {% endif %}
        </div>
        
        <!-- Account type -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Account-Typ</label>
          {{ form.account_type }}
          {% if form.account_type.errors %}
            <p class="text-red-500 text-sm mt-1">{{ form.account_type.errors.0 }}</p>
          {% endif %}
        </div>

        <!-- Password -->
        <div>
            <label for="password1" class="block text-sm font-medium text-gray-700 mb-1">{% trans "Password" %}</label>
            <input type="password" name="password1" id="password1"
                   class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-400" required>
            <ul class="mt-2 space-y-1 text-sm" id="password-rules">
                <li id="rule-length" class="text-red-500">✖ {% trans "At least 8 characters" %}</li>
                <li id="rule-uppercase" class="text-red-500">✖ {% trans "At least one uppercase letter" %}</li>
                <li id="rule-number" class="text-red-500">✖ {% trans "At least one number" %}</li>
                <li id="rule-special" class="text-red-500">✖ {% trans "At least one special character (!@#$...)" %}</li>
            </ul>
        </div>

        <!-- Password confirmation -->
        <div>
            <label for="password2" class="block text-sm font-medium text-gray-700 mb-1">{% trans "Confirm Password" %}</label>
            <input type="password" name="password2" id="password2"
                   class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-400" required>
            <p id="password-match" class="mt-2 text-sm text-red-500">✖ {% trans "Passwords do not match" %}</p>
        </div>

        <!-- Submit -->
        <button type="submit"
                class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold shadow hover:bg-blue-700 transition">
            {% trans "Register" %}
        </button>
    </form>
</div>

<!-- Passwort Check Script -->
<script>
    const password1 = document.getElementById("password1");
    const password2 = document.getElementById("password2");
    const matchMsg = document.getElementById("password-match");

    function validatePassword() {
        const val = password1.value;
        const rules = {
            length: val.length >= 8,
            uppercase: /[A-Z]/.test(val),
            number: /[0-9]/.test(val),
            special: /[^A-Za-z0-9]/.test(val),
        };

        for (let [rule, passed] of Object.entries(rules)) {
            const el = document.getElementById("rule-" + rule);
            if (passed) {
                el.classList.remove("text-red-500");
                el.classList.add("text-green-600");
                el.innerHTML = "✔ " + el.textContent.replace("✖ ", "").replace("✔ ", "");
            } else {
                el.classList.remove("text-green-600");
                el.classList.add("text-red-500");
                el.innerHTML = "✖ " + el.textContent.replace("✔ ", "").replace("✖ ", "");
            }
        }

        // Password Match
        if (password1.value && password2.value && password1.value === password2.value) {
            matchMsg.textContent = "✔ {% trans 'Passwords match' %}";
            matchMsg.classList.remove("text-red-500");
            matchMsg.classList.add("text-green-600");
        } else {
            matchMsg.textContent = "✖ {% trans 'Passwords do not match' %}";
            matchMsg.classList.remove("text-green-600");
            matchMsg.classList.add("text-red-500");
        }
    }

    password1.addEventListener("input", validatePassword);
    password2.addEventListener("input", validatePassword);
</script>
{% endblock %}
